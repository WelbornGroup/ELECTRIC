name: CI

on: 
  push:
    branches:    
      - master
  pull_request:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v1

    - name: Checkout submodules
      uses: textbook/git-checkout-submodule-action@master

    #- name: Setup Miniconda
    #  uses: conda-incubator/setup-miniconda@v2

    - name: Build dependencies
      run: |
        # Update apt-get
        sudo apt-get update

        # Install gfortran
        sudo apt-get install gfortran

        # Install conda
        #wget http://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
        #bash miniconda.sh -b -p $HOME/miniconda
        #export PATH=$HOME/miniconda/bin:$PATH
        #conda config --set always_yes yes --set changeps1 no
        #conda update -q conda
        #conda info -a

        # Install dependencies
        #conda install -c conda-forge numpy pandas
        pip install numpy
        pip install pandas
        pip install pytest
        pip install pytest-cov

    - name: Build ELECTRIC with Tinker
      run: |
        ./build.sh

    - name: Run the pytest tests
      env:
        CODECOV_TOKEN: "8b90eeee-10a0-46aa-be29-f2680364ea1a"
      run: |
        # Run pytest
        cd ELECTRIC/pytest
        pytest -vv --cov-report=xml --cov=ELECTRIC --cov=util
        ls -a -l
        bash <(curl -s https://codecov.io/bash)
